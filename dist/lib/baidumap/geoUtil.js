var BMapLib=window.BMapLib=BMapLib||{};!function(){var GeoUtils=BMapLib.GeoUtils=function(){};function _getRange(v,a,b){return null!=a&&(v=Math.max(v,a)),null!=b&&(v=Math.min(v,b)),v}function _getLoop(v,a,b){for(;b<v;)v-=b-a;for(;v<a;)v+=b-a;return v}GeoUtils.isPointInRect=function(point,bounds){if(!(point instanceof BMap.Point&&bounds instanceof BMap.Bounds))return!1;var sw=bounds.getSouthWest(),ne=bounds.getNorthEast();return point.lng>=sw.lng&&point.lng<=ne.lng&&point.lat>=sw.lat&&point.lat<=ne.lat},GeoUtils.isPointInCircle=function(point,circle){if(!(point instanceof BMap.Point&&circle instanceof BMap.Circle))return!1;var c=circle.getCenter(),r=circle.getRadius();return GeoUtils.getDistance(point,c)<=r},GeoUtils.isPointOnPolyline=function(point,polyline){if(!(point instanceof BMap.Point&&polyline instanceof BMap.Polyline))return!1;var lineBounds=polyline.getBounds();if(!this.isPointInRect(point,lineBounds))return!1;for(var pts=polyline.getPath(),i=0;i<pts.length-1;i++){var curPt=pts[i],nextPt=pts[i+1];if(point.lng>=Math.min(curPt.lng,nextPt.lng)&&point.lng<=Math.max(curPt.lng,nextPt.lng)&&point.lat>=Math.min(curPt.lat,nextPt.lat)&&point.lat<=Math.max(curPt.lat,nextPt.lat)){var precision=(curPt.lng-point.lng)*(nextPt.lat-point.lat)-(nextPt.lng-point.lng)*(curPt.lat-point.lat);if(precision<2e-10&&-2e-10<precision)return!0}}return!1},GeoUtils.isPointInPolygon=function(point,polygon){if(!(point instanceof BMap.Point&&polygon instanceof BMap.Polygon))return!1;var polygonBounds=polygon.getBounds();if(!this.isPointInRect(point,polygonBounds))return!1;var pts=polygon.getPath();console.log(pts);var p1,p2,N=pts.length,intersectCount=0,p=point;p1=pts[0];for(var i=1;i<=N;++i){if(p.equals(p1))return!0;if(p2=pts[i%N],p.lat<Math.min(p1.lat,p2.lat)||p.lat>Math.max(p1.lat,p2.lat))p1=p2;else{if(p.lat>Math.min(p1.lat,p2.lat)&&p.lat<Math.max(p1.lat,p2.lat)){if(p.lng<=Math.max(p1.lng,p2.lng)){if(p1.lat==p2.lat&&p.lng>=Math.min(p1.lng,p2.lng))return!0;if(p1.lng==p2.lng){if(p1.lng==p.lng)return!0;++intersectCount}else{var xinters=(p.lat-p1.lat)*(p2.lng-p1.lng)/(p2.lat-p1.lat)+p1.lng;if(Math.abs(p.lng-xinters)<2e-10)return!0;p.lng<xinters&&++intersectCount}}}else if(p.lat==p2.lat&&p.lng<=p2.lng){var p3=pts[(i+1)%N];p.lat>=Math.min(p1.lat,p3.lat)&&p.lat<=Math.max(p1.lat,p3.lat)?++intersectCount:intersectCount+=2}p1=p2}}return intersectCount%2!=0},GeoUtils.degreeToRad=function(degree){return Math.PI*degree/180},GeoUtils.radToDegree=function(rad){return 180*rad/Math.PI},GeoUtils.getDistance=function(point1,point2){return point1 instanceof BMap.Point&&point2 instanceof BMap.Point?(point1.lng=_getLoop(point1.lng,-180,180),point1.lat=_getRange(point1.lat,-74,74),point2.lng=_getLoop(point2.lng,-180,180),point2.lat=_getRange(point2.lat,-74,74),x1=GeoUtils.degreeToRad(point1.lng),y1=GeoUtils.degreeToRad(point1.lat),x2=GeoUtils.degreeToRad(point2.lng),y2=GeoUtils.degreeToRad(point2.lat),6370996.81*Math.acos(Math.sin(y1)*Math.sin(y2)+Math.cos(y1)*Math.cos(y2)*Math.cos(x2-x1))):0;var x1,x2,y1,y2},GeoUtils.getPolylineDistance=function(polyline){if(polyline instanceof BMap.Polyline||polyline instanceof Array){var pts;if((pts=polyline instanceof BMap.Polyline?polyline.getPath():polyline).length<2)return 0;for(var totalDis=0,i=0;i<pts.length-1;i++){var curPt=pts[i],nextPt=pts[i+1];totalDis+=GeoUtils.getDistance(curPt,nextPt)}return totalDis}return 0},GeoUtils.getPolygonArea=function(polygon){if(!(polygon instanceof BMap.Polygon||polygon instanceof Array))return 0;var pts;if((pts=polygon instanceof BMap.Polygon?polygon.getPath():polygon).length<3)return 0;for(var tempSum1,tempSum2,LowX=0,LowY=0,MiddleX=0,MiddleY=0,HighX=0,HighY=0,AM=0,BM=0,CM=0,AL=0,BL=0,CL=0,AH=0,BH=0,CH=0,CoefficientL=0,CoefficientH=0,ALtangent=0,BLtangent=0,CLtangent=0,AHtangent=0,BHtangent=0,CHtangent=0,AngleCos=0,Sum1=0,Sum2=0,Count2=0,Count1=0,Count=pts.length,i=0;i<Count;i++)0==i?(LowX=pts[Count-1].lng*Math.PI/180,LowY=pts[Count-1].lat*Math.PI/180,MiddleX=pts[0].lng*Math.PI/180,MiddleY=pts[0].lat*Math.PI/180,HighX=pts[1].lng*Math.PI/180,HighY=pts[1].lat*Math.PI/180):i==Count-1?(LowX=pts[Count-2].lng*Math.PI/180,LowY=pts[Count-2].lat*Math.PI/180,MiddleX=pts[Count-1].lng*Math.PI/180,MiddleY=pts[Count-1].lat*Math.PI/180,HighX=pts[0].lng*Math.PI/180,HighY=pts[0].lat*Math.PI/180):(LowX=pts[i-1].lng*Math.PI/180,LowY=pts[i-1].lat*Math.PI/180,MiddleX=pts[i].lng*Math.PI/180,MiddleY=pts[i].lat*Math.PI/180,HighX=pts[i+1].lng*Math.PI/180,HighY=pts[i+1].lat*Math.PI/180),AM=Math.cos(MiddleY)*Math.cos(MiddleX),BM=Math.cos(MiddleY)*Math.sin(MiddleX),CM=Math.sin(MiddleY),AL=Math.cos(LowY)*Math.cos(LowX),BL=Math.cos(LowY)*Math.sin(LowX),CL=Math.sin(LowY),AngleCos=((AHtangent=(CoefficientH=(AM*AM+BM*BM+CM*CM)/(AM*(AH=Math.cos(HighY)*Math.cos(HighX))+BM*(BH=Math.cos(HighY)*Math.sin(HighX))+CM*(CH=Math.sin(HighY))))*AH-AM)*(ALtangent=(CoefficientL=(AM*AM+BM*BM+CM*CM)/(AM*AL+BM*BL+CM*CL))*AL-AM)+(BHtangent=CoefficientH*BH-BM)*(BLtangent=CoefficientL*BL-BM)+(CHtangent=CoefficientH*CH-CM)*(CLtangent=CoefficientL*CL-CM))/(Math.sqrt(AHtangent*AHtangent+BHtangent*BHtangent+CHtangent*CHtangent)*Math.sqrt(ALtangent*ALtangent+BLtangent*BLtangent+CLtangent*CLtangent)),AngleCos=Math.acos(AngleCos),0<(0!=AM?(BHtangent*CLtangent-CHtangent*BLtangent)/AM:0!=BM?(0-(AHtangent*CLtangent-CHtangent*ALtangent))/BM:(AHtangent*BLtangent-BHtangent*ALtangent)/CM)?(Sum1+=AngleCos,Count1++):(Sum2+=AngleCos,Count2++);return tempSum1=Sum1+(2*Math.PI*Count2-Sum2),tempSum2=2*Math.PI*Count1-Sum1+Sum2,6370996.81*((Sum2<Sum1?tempSum1-(Count-2)*Math.PI<1?tempSum1:tempSum2:tempSum2-(Count-2)*Math.PI<1?tempSum2:tempSum1)-(Count-2)*Math.PI)*6370996.81}}();