var menu=new FlMenu,pageUrl=PublicUrl.auditProgramUrl(),materialUrl=PublicUrl.auditMaterialUrl(),mobileListData=new MobileListData({url:pageUrl,data:{programName:$("#search-name").val(),isAuditStatus:$("#search-auditState").val()},listObj:"#audit-list-data",getListHtml:getListHtml}),auditType="2",videoPlayer=null;function getListHtml(data){for(var shtml="",allChecked=$("#checkAll").prop("checked"),i=0,len=data.length;i<len;i++){var itemData=data[i],programId=itemData.programId,programName=itemData.programName,isAuditStatusData=itemData.isAuditStatus;isAuditStatus=Public.isStatus(isAuditStatusData),updateBy=itemData.updateBy,updateDate=Public.momentFormat(itemData.updateDate,"YYYY-MM-DD HH:mm:ss"),isCommonStatus=Public.isCommon(itemData.isCommonStatus),shtml+='<div class="item"><div class="head"><div class="label-checked-box pull-left"><input type="checkbox" '+(allChecked?"checked":"")+' id="check-'+programId+'" value="'+programId+'" data-state="'+isAuditStatusData+'" /><label for="check-'+programId+'"></label></div><div class="pull-left"><span class="name">'+programName+' </span> </div><div class="icon pull-right clearfix"><a href="javascript:void(0);" class="iconfont icon-chakan pull-right item-play" data-id="'+programId+'"></a></div></div><div class="info"><div class="row"><div class="col-50"><div class="name pull-left">审核状态： </div><div class="data pull-left"><span class="font-green">'+isAuditStatus+'</span></div></div><div class="col-50"><div class="name pull-left">公开状态：</div><div class="data pull-left"><span class="font-green">'+isCommonStatus+'</span></div></div></div><div class="row"><div class="col-50"><div class="name pull-left">更新人：</div><div class="data pull-left">'+updateBy+' </div></div></div><div class="row"><div class="col-80"><div class="name pull-left">更新时间：</div><div class="data pull-left">'+updateDate+"</div></div></div></div></div>"}return shtml}function getMediaListHtml(data){for(var shtml='<div class="row">',allChecked=$("#checkAll").prop("checked"),i=0,len=data.length;i<len;i++)shtml+=PublicDataHtml.getMediaHtml(data[i],allChecked);return shtml+"</div>"}function searchMaterial(){mobileListData.options.data={materialAuditStatus:$("#search-auditState").val(),materialLabel:$("#search-name").val()},mobileListData.options.getListHtml=getMediaListHtml,mobileListData.options.dataSuccessCall=function(data){echo.init({offset:0,throttle:0,container:document.getElementById("content-list"),callback:function(element,op){}})}}function searchProgram(){mobileListData.options.data={isAuditStatus:$("#search-auditState").val(),programName:$("#search-name").val()},mobileListData.options.getListHtml=getListHtml,mobileListData.options.dataSuccessCall=function(){}}function refreshData(){mobileListData.options.initData=!0,mobileListData.init()}function auditAjax(url,params,ids){Public.ajaxCall({type:"POST",url:url+ids,data:params,successCallBack:function(data){Public.toast(data.response),setTimeout(function(){refreshData()},300)}})}$(function(){Public.showPreloader("加载中..."),$.init(),menu.init(),mobileListData.init(),videoPlayer=$("#video-player").videoPlayer(),Public.calendar("#datetime-start,#datetime-end",{value:[Public.momentFormat(new Date,"YYYY-MM-DD")]}),$(document).on("click",".picture",function(){var url=$(this).attr("data-url");$(".popup-picture").find("img").attr("src",url),Public.popup(".popup-picture")}),$(document).on("click",".video",function(){var url=$(this).attr("data-src");$("#video-player video").attr("src",url),Public.popup(".popup-video"),videoPlayer.btnInit()}),$(document).on("click",".video-close-popup",function(){videoPlayer.stopVideo()}),$(document).on("click",".fl-menu-btn",function(){auditType=$(this).attr("data-type");var $title=$("#header-title"),$contentPage=$(".content-page-list"),url="";$("#checkAll").prop("checked",!1),"1"===auditType?($title.text("素材审核"),url=materialUrl,searchMaterial(),$contentPage.removeClass("content-play-list").addClass("content-media-list")):"2"===auditType&&($title.text("节目审核"),url=pageUrl,searchProgram(),$contentPage.removeClass("content-media-list").addClass("content-play-list")),mobileListData.options.url=url,refreshData()}),$(document).on("click",".confirm-audit",function(){for(var $checkboxList=$("#audit-list-data input:checked"),len=$checkboxList.length,checkboxIdArr=[],type=$(this).attr("data-type"),confirmTitle="",isAuditFinArr=[],ajaxUrl="",ajaxData={},i=0;i<len;i++){var $check=$($checkboxList[i]),val=$check.val(),state=$check.attr("data-state");isAuditFinArr.push(state),checkboxIdArr.push(val)}if(isAuditFinArr=Public.uniqueArray(isAuditFinArr),0<len){if(2<=isAuditFinArr.length)return void Public.toast("包含已审核的内容");if("1"===type){if("1"===isAuditFinArr[0])return void Public.toast("该项目未通过审核！");confirmTitle="确定被选中的项目取消审核？"}else if("2"===type){if("2"===isAuditFinArr[0])return void Public.toast("该项目已通过审核！");confirmTitle="确定被选中的项目通过审核？"}"1"===auditType?(ajaxUrl=PublicUrl.auditMaterialStateUrl(),ajaxData={materialAuditStatus:type,_method:"put"}):"2"===auditType&&(ajaxUrl=PublicUrl.auditProgramStateUrl(),ajaxData={isAuditStatus:type,_method:"put"}),Public.msuiConfirm(confirmTitle,function(){auditAjax(ajaxUrl,ajaxData,checkboxIdArr)})}else Public.toast(locales.promptChecked)}),Public.mvalidate({obj:"#audit-form",descriptions:{name:{required:locales.validateName,pattern:locales.validateRq}},validCall:function(){$("#audit-submit").attr("disabled","disabled");var url="";"1"===auditType?(url=materialUrl,searchMaterial()):"2"===auditType&&(url=pageUrl,searchProgram()),mobileListData.options.url=url,refreshData(),Public.closeModal(".popup-search"),setTimeout(function(){$("#audit-submit").removeAttr("disabled")},300)}}),$(document).on("click",".item-play",function(){var programId=$(this).attr("data-id");Public.ajaxCall({type:"GET",url:PublicUrl.programContPageUrl()+programId,successCallBack:function(data){for(var response=data.response,jsonData=JSON.parse(response.showList).showInfo,width=jsonData.programWidthPoints,height=jsonData.programHeightPoints,pageList=jsonData.pageList,len=pageList.length,shtml="",i=0;i<len;i++){var pageListItem=pageList[i];shtml+='<li>                        <div class="row">                            <div class="col-40">                               '+pageListItem.pageName+'                            </div>                            <div class="col-40">                                '+pageListItem.pagePlaytime+'S                            </div>                            <div class="col-20">                                <a class="iconfont icon-bofang play" href=\'show/demo.html?js='+(PublicUrl.materialResourceUrl()+pageListItem.pageFilePath).replace(/\\/g,"/")+"&width="+(width=width)+"&height="+(height=height)+"'></a>                            </div>                        </div>                    </li>"}$("#popup-program-show-list").empty(),$("#popup-program-show-list").append(shtml),Public.popup(".popup-program-show")}})})});