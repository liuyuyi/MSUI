var menu=new FlMenu,mobileListData=new MobileListData({url:PublicUrl.taskListUrl(),data:{groupId:0,taskStatus:$("#task-state").val(),type:2,taskType:"",languageType:Public.languageType,devCode:$("#mornitor-searcheq").val(),startTime:$("#datetime-start").val(),endTime:$("#datetime-end").val()},listObj:"#mornitor-list-data",getListHtml:getListHtml}),searchDateObj=null;function getListHtml(data){for(var shtml="",i=0,len=data.length;i<len;i++){var itemData=data[i];devCode=itemData.devCode,devName=itemData.devName,taskId=itemData.taskId,programName=itemData.programName,taskStatus=Public.isTaskStatue(itemData.taskStatus),taskPercent=itemData.taskPercent,taskType=Public.isPramStatue(itemData.taskType),updateDate=Public.momentFormat(itemData.updateDate,"YYYY-MM-DD HH:mm:ss"),taskContent=itemData.taskContent,statusDisplay="none",deleteDisplay="none",3==taskStatus&&(statusDisplay="block"),0!=taskPercent&&null!=taskPercent||(deleteDisplay="block"),shtml+='<div class="item" data-info="'+taskContent+'"><div class="head"><span class="name">'+devCode+'</span><div class="icon pull-right clearfix"><a href="javascript:void(0);" class="iconfont icon-iconfontfasong pull-right task-sendagin" data-taskid="'+taskId+'" style="display:'+statusDisplay+'"></a><a href="javascript:void(0);" class="iconfont icon-shanchu1 pull-right task-delete" data-taskid="'+taskId+'" style="display:'+deleteDisplay+'"></a></div></div><div class="info"><div class="row"><div class="col-100"><div class="name pull-left">节目名称：</div><div class="data pull-left">'+(programName||"")+'</div></div></div><div class="row"><div class="col-100"><div class="name pull-left">设备名称：</div><div class="data pull-left">'+devName+'</div></div></div><div class="row"><div class="col-50"><div class="name pull-left">任务进度：</div><div class="data pull-left">'+taskPercent+'</div></div></div><div class="row"><div class="col-100"><div class="name pull-left">下发类型：</div><div class="data pull-left">'+taskType+'</div></div></div><div class="row"><div class="col-100"><div class="name pull-left">任务状态：</div><div class="data pull-left">'+taskStatus+'</div></div></div><div class="row"><div class="col-80"><div class="name pull-left">创建时间：</div><div class="data pull-left">'+updateDate+"</div></div></div></div></div>"}return shtml}function refreshData(){for(var sendTypeArr,state=$("#task-state").val(),taskType=[],devCode=$("#task-searcheq").val(),starTime=$("#datetime-start").val(),endTime=$("#datetime-end").val(),param={groupId:treeEq.getSelectedItemId(),taskStatus:state,languageType:Public.languageType,devCode:devCode,startTime:starTime,endTime:endTime,type:2},dataItems=$("#multi-select").attr("data-items"),i=0,len=(sendTypeArr=""===dataItems||null===dataItems?[]:dataItems.split(",")).length;i<len;i++){var typeId=0;"下发频道"===sendTypeArr[i]?typeId=140:"下发节目"===sendTypeArr[i]?typeId=150:"插播节目"===sendTypeArr[i]?typeId=160:"插播字幕"===sendTypeArr[i]&&(typeId=170),taskType.push(typeId)}param.taskType=JSON.stringify(taskType),mobileListData.options.data=param,mobileListData.options.initData=!0,mobileListData.init(),$("#task-submit").removeAttr("disabled")}function setTaskStatus(taskId,status){Public.ajaxCall({type:"POST",url:PublicUrl.taskInfoUrl(),data:{taskId:taskId,taskStatus:status},successCallBack:function(data){Public.toast(data.response),refreshData()}})}$(function(){Public.showPreloader("加载中..."),$.init(),menu.init(),mobileListData.init(),treeEq=Public.dhtmlxTreeGroupNoCheck(function(){refreshData()}),treeEq.attachEvent("onClick",function(id,state){refreshData()}),$(document).on("click","#search-popup",function(){Public.popup(".popup-search"),null===searchDateObj&&(searchDateObj=Public.datetimePicker({obj:"#map-beginTime,#map-endTime"}))}),$(document).on("click","#task-submit",function(){var starTime=$("#datetime-start").val(),endTime=$("#datetime-end").val(),params={starDate:starTime,endDate:endTime};$("#task-submit").attr("disabled","disabled"),Public.momentIsBefore(params)||Public.momentIsSame(params)||!Public.isDefine(starTime)&&!Public.isDefine(endTime)?(Public.closeModal(".popup-search"),refreshData()):($("#task-submit").removeAttr("disabled"),Public.toast(locales.dateMoment))}),$("#multi-select").multiSelect({title:"选择任务类型",select:["下发频道","下发节目","插播节目","插播字幕"]}),$(document).on("click","#eq-popup",function(){Public.popup(".popup-eq")}),$(document).on("click",".task-sendagin",function(){var taskId=$(this).attr("data-taskid");Public.msuiConfirm("确定重新发送该任务？",function(){setTaskStatus(taskId,0)})}),$(document).on("click",".task-delete",function(){var taskId=$(this).attr("data-taskid");Public.msuiConfirm("确定删除该任务？",function(){setTaskStatus(taskId,6)})}),$(document).on("click","#mornitor-list-data .item",function(){var info=$(this).attr("data-info");$("#task-info").text(info),Public.popup(".popup-program-show")}),Public.datetimePicker({obj:"#datetime-start, #datetime-end",format:"YYYY-MM-DD hh:mm:ss"})});